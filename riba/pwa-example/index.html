<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ribar LOT - Sljedivost ribe</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ribar LOT">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Ekran 0: Vessel Setup (First Time) -->
        <div id="screen-vessel-setup" class="screen">
            <header class="header">
                <h2>üö¢ PODACI O PLOVILU</h2>
                <p>Podaci se unose jednom i spremaju za sve buduƒáe LOT-ove</p>
            </header>
            
            <main class="main-content">
                <div class="vessel-form">
                    <div class="form-group">
                        <label for="cfr-input">CFR broj plovila *</label>
                        <input type="text" id="cfr-input" placeholder="HRV123456789" 
                               maxlength="15" style="text-transform: uppercase;">
                        <small>Format: 3 slova + 9-12 brojki (npr. HRV123456789)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="registration-input">Registarska oznaka *</label>
                        <input type="text" id="registration-input" placeholder="ST-123-AB" 
                               maxlength="20" style="text-transform: uppercase;">
                        <small>Registarska oznaka plovila</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="logbook-input">Broj oƒçevidnika *</label>
                        <div class="logbook-input-container">
                            <span class="logbook-prefix">HRVLOG</span>
                            <input type="text" id="logbook-input" placeholder="1234567890123" 
                                   maxlength="13" pattern="[0-9]{13}">
                        </div>
                        <small>Toƒçno 13 brojki nakon "HRVLOG" (novi format)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="vessel-name-input">Ime plovila</label>
                        <input type="text" id="vessel-name-input" placeholder="Npr. Jadran I" 
                               maxlength="50">
                        <small>Neobavezno - ime plovila</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="gear-category-select">Kategorija ribolovnog alata *</label>
                        <select id="gear-category-select" required>
                            <option value="">-- Odaberi kategoriju --</option>
                            <option value="GNS">GNS - Mre≈æe pridnene - pojedinaƒçne</option>
                            <option value="GND">GND - Mre≈æe plutajuƒáe</option>
                            <option value="GTR">GTR - Mre≈æe trostruke</option>
                            <option value="LLS">LLS - Palangre pridneni</option>
                            <option value="LLD">LLD - Palangre plutajuƒái</option>
                            <option value="LHP">LHP - Udice ruƒçne</option>
                            <option value="LHM">LHM - Udice ma≈°inske</option>
                            <option value="FPO">FPO - Klopke/ko≈°are</option>
                            <option value="PS1">PS1 - Mre≈æe optkolne</option>
                            <option value="OTB">OTB - Koƒáarske mre≈æe pridnene</option>
                            <option value="PTB">PTB - Koƒáarske mre≈æe parne</option>
                            <option value="TBN">TBN - Koƒáarske mre≈æe ostale</option>
                        </select>
                        <small>FAO/EU standardne kategorije ribolovnog alata</small>
                    </div>
                    
                    <div class="validation-errors" id="vessel-errors" style="display: none;"></div>
                    
                    <button id="save-vessel-btn" class="primary-btn">
                        ‚úÖ SPREMI PODATKE
                    </button>
                </div>
            </main>
        </div>

        <!-- Ekran 1: Fishing Zone Selection -->
        <div id="screen-fishing-zone" class="screen">
            <header class="header">
                <h2>üé£ ODABIR RIBOLOVNE ZONE</h2>
                <p>Odabir zone je obavezan prije generiranja LOT-a</p>
            </header>
            
            <main class="main-content">
                <div class="zone-grid" id="zone-grid">
                    <!-- Dinamiƒçki generirane zone -->
                </div>
                
                <div class="selected-zone-info" id="selected-zone-info" style="display: none;">
                    <h3>Odabrana zona:</h3>
                    <p id="zone-description"></p>
                </div>
                
                <button id="confirm-zone-btn" class="primary-btn" style="display: none;">
                    ‚úÖ POTVRDI ZONU
                </button>
            </main>
        </div>

        <!-- Ekran 2: Novi ulov -->
        <div id="screen-home" class="screen">
            <header class="header">
                <h1>üêü RIBAR LOT</h1>
                <div class="status-bar">
                    <span id="location-status">üìç Dohvaƒáam lokaciju...</span>
                    <span id="date-time">üìÖ Loading...</span>
                    <span id="offline-status" class="offline">üíæ Offline: ‚úì</span>
                </div>
            </header>
            
            <main class="main-content">
                <button id="new-catch-btn" class="primary-btn large">
                    üé£ NOVI ULOV
                </button>
                
                <div class="daily-stats">
                    <p>üìä Dana≈°nji ulovi: <span id="daily-count">0</span></p>
                </div>
            </main>
        </div>

        <!-- Ekran 3: Odabir vrste -->
        <div id="screen-species" class="screen">
            <header class="header">
                <button class="back-btn" onclick="goToScreen('screen-home')">‚Üê NATRAG</button>
                <h2>ODABERI VRSTU</h2>
            </header>
            
            <main class="main-content">
                <div class="search-bar">
                    <input type="text" id="species-search" placeholder="üîç Pretra≈æi po imenu">
                </div>
                
                <div id="species-grid" class="species-grid">
                    <!-- Dinamiƒçki generirane vrste -->
                </div>
            </main>
        </div>

        <!-- Ekran 3: Unos koliƒçine -->
        <div id="screen-quantity" class="screen">
            <header class="header">
                <button class="back-btn" onclick="goToScreen('screen-species')">‚Üê NATRAG</button>
                <h2 id="selected-species-name">VRSTA</h2>
            </header>
            
            <main class="main-content">
                <div class="species-info">
                    <p>FAO: <span id="species-fao">---</span></p>
                    <p>Znanstveno: <span id="species-scientific">---</span></p>
                </div>
                
                <div class="quantity-input">
                    <label>UKUPNO KILOGRAM:</label>
                    <input type="text" id="weight-display" readonly value="0">
                </div>
                
                <div class="keypad">
                    <button class="key-btn" onclick="addDigit('1')">1</button>
                    <button class="key-btn" onclick="addDigit('2')">2</button>
                    <button class="key-btn" onclick="addDigit('3')">3</button>
                    <button class="key-btn" onclick="addDigit('4')">4</button>
                    <button class="key-btn" onclick="addDigit('5')">5</button>
                    <button class="key-btn" onclick="addDigit('6')">6</button>
                    <button class="key-btn" onclick="addDigit('7')">7</button>
                    <button class="key-btn" onclick="addDigit('8')">8</button>
                    <button class="key-btn" onclick="addDigit('9')">9</button>
                    <button class="key-btn" onclick="addDigit('.')">.</button>
                    <button class="key-btn" onclick="addDigit('0')">0</button>
                    <button class="key-btn delete" onclick="deleteDigit()">‚å´</button>
                    <button class="key-btn clear" onclick="clearWeight()">C</button>
                </div>
                
                <div class="undersized-catch-section">
                    <h4>‚ö†Ô∏è Riba ispod minimalne veliƒçine</h4>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="undersized" value="false" id="undersized-no" checked>
                            <span class="radio-text">Ne - nema ribe ispod minimalne veliƒçine</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="undersized" value="true" id="undersized-yes">
                            <span class="radio-text">Da - ima ribe ispod minimalne veliƒçine</span>
                        </label>
                    </div>
                    
                    <div id="undersized-quantity-input" class="hidden">
                        <label for="undersized-weight">Koliƒçina ribe ispod min. veliƒçine (kg) *</label>
                        <input type="number" id="undersized-weight" step="0.1" min="0.1" 
                               placeholder="0.0" class="quantity-input-small">
                        <small>Obavezno ako postoji riba ispod minimalne veliƒçine</small>
                    </div>
                </div>
                
                <button id="continue-btn" class="primary-btn" onclick="generateLOT()">
                    DALJE
                </button>
            </main>
        </div>

        <!-- Ekran 4: LOT rezultat -->
        <div id="screen-result" class="screen">
            <header class="header">
                <h2>‚úÖ LOT KREIRAN</h2>
            </header>
            
            <main class="main-content">
                <div class="lot-summary" id="lot-summary">
                    <!-- Dinamiƒçki generiran sa≈æetak -->
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="downloadPDF()">
                        üìÑ PREUZMI PDF
                    </button>
                    <button class="export-btn" onclick="downloadCSV()">
                        üìä PREUZMI CSV
                    </button>
                    <button class="export-btn" onclick="showQR()">
                        üì± PRIKA≈ΩI QR KOD
                    </button>
                    <button class="export-btn" onclick="generateLabel()">
                        üè∑Ô∏è NALIJEPNICA ZA AMBALA≈ΩU
                    </button>
                </div>
                
                <div class="compliance-warning">
                    <p>‚ö†Ô∏è <strong>OBAVEZNO:</strong> LOT broj mora biti fiziƒçki oznaƒçen na ambala≈æi proizvoda (Uredba EU 2023/2842, ƒçl. 58)</p>
                </div>
                
                <button class="primary-btn" onclick="newCatch()">
                    üîÑ NOVI ULOV
                </button>
            </main>
        </div>

        <!-- QR Code Modal -->
        <div id="qr-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div id="qr-code"></div>
                <p>LOT ID: <span id="qr-lot-id"></span></p>
            </div>
        </div>
    </div>

    <!-- AGGRESSIVE CACHE CLEAR - FORCE RELOAD ALL FILES -->
    <script>
        console.log('üóëÔ∏è AGGRESSIVE CACHE CLEAR - FORCING FRESH LOAD');
        
        // Clear IndexedDB
        indexedDB.deleteDatabase('FishermanLOT');
        
        // Clear all caches
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => {
                    console.log('üóëÔ∏è Deleting cache:', name);
                    caches.delete(name);
                });
            });
        }
        
        // Clear localStorage and sessionStorage
        localStorage.clear();
        sessionStorage.clear();
        
        console.log('üîÑ All caches cleared - loading fresh files');
    </script>
    
    <!-- Scripts with NEW timestamp - CATEGORIZED SPECIES INTERFACE -->
    <script src="js/db.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/gps.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/vessel-config.js?v=4.0&t=20260107180000&bust=${Math.random()}"></script>
    <script src="js/lot-manager.js?v=4.0&t=20260107180000&bust=${Math.random()}"></script>
    <script src="js/lot-generator.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/export.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/professional-app.js?v=4.0&t=20260107190000&bust=${Math.random()}"></script>
    
    <!-- SERVICE WORKER DISABLED - NO CACHING DURING DEVELOPMENT -->
    <script>
        console.log('üö´ Service Worker disabled to prevent caching issues');
        
        // Unregister any existing service workers
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => {
                    console.log('üóëÔ∏è Unregistering Service Worker:', registration);
                    registration.unregister();
                });
            });
        }
        
        console.log('‚úÖ No caching - files will load fresh every time');
    </script>
</body>
</html>
