<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêü Ribar LOT - EU 2023/2842 Compliant v2.1</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ribar LOT">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Ekran 0: Vessel Setup (First Time) -->
        <div id="screen-vessel-setup" class="screen">
            <header class="header-senior">
                <h1>üö¢ PODE≈†AVANJE BRODA</h1>
                <p class="header-subtitle-senior">Unesite podatke o va≈°em brodu (samo jednom)</p>
            </header>
            
            <main class="main-content-senior">
                <div class="vessel-form-senior">
                    <div class="progress-indicator-senior">
                        <div class="progress-step active">1</div>
                        <div class="progress-label">Podaci o brodu</div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="cfr-input" class="label-senior">üè∑Ô∏è Broj broda (CFR) *</label>
                        <input type="text" id="cfr-input" class="input-senior" placeholder="HRV000000000" 
                               maxlength="15" style="text-transform: uppercase;">
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Unesite broj broda - poƒçinje s HRV i ima brojke
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="registration-input" class="label-senior">üìã Oznaka broda *</label>
                        <input type="text" id="registration-input" class="input-senior" placeholder="ST-123-AB" 
                               maxlength="20" style="text-transform: uppercase;">
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Oznaka koja je napisana na brodu
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="logbook-input" class="label-senior">üìñ Broj dnevnika *</label>
                        <div class="logbook-input-container-senior">
                            <span class="logbook-prefix-senior">HRVLOG</span>
                            <input type="text" id="logbook-input" class="input-senior logbook-input" 
                                   placeholder="1234567890123" maxlength="13" pattern="[0-9]{13}">
                        </div>
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            13 brojki iz ribolovnog dnevnika
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="vessel-name-input" class="label-senior">‚öì Ime broda (neobavezno)</label>
                        <input type="text" id="vessel-name-input" class="input-senior" placeholder="Moj brod" 
                               maxlength="50">
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Kako se zove va≈° brod
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="fisherman-name-input" class="label-senior">üë§ Va≈°e ime i prezime *</label>
                        <input type="text" id="fisherman-name-input" class="input-senior" placeholder="Ivo Mariƒá" 
                               maxlength="100" required>
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Unesite svoje ime kao vlasnik broda
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="fishing-gear-select" class="label-senior">üé£ ƒåime lovite ribu? *</label>
                        <select id="fishing-gear-select" class="select-senior" required>
                            <option value="">Odaberite va≈° alat za ribolov...</option>
                            <optgroup label="üåä Mre≈æe koje plutaju">
                                <option value="PS">Plivarica (za srdele, tune)</option>
                            </optgroup>
                            <optgroup label="üé£ Mre≈æe koje stoje">
                                <option value="GNS">Mre≈æe stajaƒáice</option>
                                <option value="GTR">Trostruke mre≈æe</option>
                                <option value="LLS">Parangal (stoji)</option>
                                <option value="LLD">Parangal (pluta)</option>
                            </optgroup>
                            <optgroup label="üö§ Mre≈æe koje se vuku">
                                <option value="OTB">Koƒáa (velika mre≈æa)</option>
                                <option value="SV">Potegaƒça (mala mre≈æa)</option>
                                <option value="DRB">Dred≈æa (za ≈°koljke)</option>
                            </optgroup>
                            <optgroup label="üéØ Ostali naƒçini">
                                <option value="FPO">Vr≈°e (ko≈°evi za ribu)</option>
                                <option value="LHP">Povraz s udica</option>
                                <option value="HAR">Osti</option>
                                <option value="OTH">Ostalo</option>
                            </optgroup>
                        </select>
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Odaberite kako najƒçe≈°ƒáe lovite ribu
                        </div>
                    </div>
                    
                    <div class="validation-errors-senior" id="vessel-errors" style="display: none;"></div>
                    
                    <button id="save-vessel-btn" class="btn-senior-primary">
                        ‚úÖ SPREMI I NASTAVI
                    </button>
                </div>
            </main>
        </div>

        <!-- Ekran 1: Fishing Zone Selection -->
        <div id="screen-fishing-zone" class="screen">
            <header class="header-senior">
                <h1>üåä GDJE LOVITE RIBU?</h1>
                <p class="header-subtitle-senior">Odaberite podruƒçje u kojem ste lovili ribu</p>
            </header>
            
            <main class="main-content-senior">
                <div class="progress-indicator-senior">
                    <div class="progress-step active">2</div>
                    <div class="progress-label">Ribolovno podruƒçje</div>
                </div>
                
                <div class="zone-grid-senior" id="zone-grid">
                    <!-- Dinamiƒçki generirane zone -->
                </div>
                
                <div class="selected-zone-info-senior" id="selected-zone-info" style="display: none;">
                    <div class="zone-confirmation-card">
                        <h3>‚úÖ Odabrali ste:</h3>
                        <div id="zone-description" class="zone-description-senior"></div>
                    </div>
                </div>
                
                <button id="confirm-zone-btn" class="btn-senior-primary" style="display: none;">
                    ‚úÖ POTVRDI I NASTAVI
                </button>
            </main>
        </div>

        <!-- Ekran 2: Novi ulov -->
        <div id="screen-home" class="screen">
            <header class="header">
                <h1>üêü RIBAR LOT</h1>
                <div class="status-bar">
                    <span id="location-status">üìç Dohvaƒáam lokaciju...</span>
                    <span id="date-time">üìÖ Loading...</span>
                    <span id="offline-status" class="offline">üíæ Offline: ‚úì</span>
                </div>
            </header>
            
            <main class="main-content">
                <button id="new-catch-btn" class="primary-btn large">
                    üé£ NOVI ULOV
                </button>
                
                <div class="daily-stats">
                    <p>üìä Dana≈°nji ulovi: <span id="daily-count">0</span></p>
                </div>
            </main>
        </div>

        <!-- Ekran 3: Odabir vrste -->
        <div id="screen-species" class="screen">
            <header class="header">
                <button class="back-btn" onclick="goToScreen('screen-home')">‚Üê NATRAG</button>
                <h2>ODABERI VRSTU</h2>
            </header>
            
            <main class="main-content">
                <div class="search-bar">
                    <input type="text" id="species-search" placeholder="üîç Pretra≈æi po imenu">
                </div>
                
                <div id="species-grid" class="species-grid">
                    <!-- Dinamiƒçki generirane vrste -->
                </div>
            </main>
        </div>

        <!-- Ekran 4: Koliƒçina -->
        <div id="screen-quantity" class="screen">
            <header class="header-senior">
                <h1>‚öñÔ∏è KOLIKO IMATE RIBE?</h1>
                <p class="header-subtitle-senior">Unesite te≈æinu ili broj komada ulovljene ribe</p>
            </header>
            
            <main class="main-content-senior">
                <div class="progress-indicator-senior">
                    <div class="progress-step active">3</div>
                    <div class="progress-label">Koliƒçina ribe</div>
                </div>
                
                <div class="species-info-senior">
                    <h3>üêü <span id="selected-species-name">Odabrana riba</span></h3>
                    <div class="species-details-senior">
                        <span class="species-fao-senior" id="species-fao">---</span>
                    </div>
                </div>
                
                <!-- Senior-friendly quantity type selection -->
                <div class="quantity-type-selection-senior">
                    <h3 class="section-title-senior">üî¢ Kako mjeriti?</h3>
                    <div class="quantity-type-buttons-senior">
                        <button type="button" id="quantity-type-weight" class="quantity-type-btn-senior active" data-type="WEIGHT">
                            <div class="qty-icon">‚öñÔ∏è</div>
                            <div class="qty-text">
                                <div class="qty-title">Kilogrami</div>
                                <div class="qty-desc">Te≈°ka riba</div>
                            </div>
                        </button>
                        <button type="button" id="quantity-type-units" class="quantity-type-btn-senior" data-type="UNITS">
                            <div class="qty-icon">üêü</div>
                            <div class="qty-text">
                                <div class="qty-title">Komada</div>
                                <div class="qty-desc">Broj riba</div>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="quantity-input-senior">
                    <label id="quantity-label-senior" class="quantity-label-senior">KOLIKO KILOGRAM?</label>
                    <div class="weight-display-container-senior">
                        <input type="text" id="weight-display" class="weight-display-senior" readonly value="0">
                        <span class="weight-unit-senior">kg</span>
                    </div>
                </div>
                
                <div class="keypad-senior">
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('1')">1</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('2')">2</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('3')">3</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('4')">4</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('5')">5</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('6')">6</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('7')">7</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('8')">8</button>
                    <button class="key-btn-senior" onclick="professionalFishermanApp.addDigit('9')">9</button>
                    <button class="key-btn-senior decimal" onclick="professionalFishermanApp.addDigit('.')">.</button>
                    <button class="key-btn-senior zero" onclick="professionalFishermanApp.addDigit('0')">0</button>
                    <button class="key-btn-senior delete" onclick="professionalFishermanApp.deleteDigit()">‚å´</button>
                </div>
                
                <div class="keypad-actions-senior">
                    <button class="key-btn-senior clear" onclick="professionalFishermanApp.clearWeight()">
                        üóëÔ∏è OBRI≈†I SVE
                    </button>
                </div>
                
                <div class="undersized-catch-section-senior">
                    <h4 class="section-title-senior">‚ö†Ô∏è Mala riba?</h4>
                    <div class="help-text-senior">
                        <span class="help-icon">‚ÑπÔ∏è</span>
                        Ima li ribe koja je premala (ispod dozvoljene veliƒçine)?
                    </div>
                    
                    <div class="radio-group-senior">
                        <label class="radio-label-senior">
                            <input type="radio" name="undersized" value="false" id="undersized-no" checked>
                            <div class="radio-content-senior">
                                <span class="radio-icon">‚úÖ</span>
                                <span class="radio-text-senior">Ne - sve ribe su dovoljno velike</span>
                            </div>
                        </label>
                        <label class="radio-label-senior">
                            <input type="radio" name="undersized" value="true" id="undersized-yes">
                            <div class="radio-content-senior">
                                <span class="radio-icon">‚ö†Ô∏è</span>
                                <span class="radio-text-senior">Da - ima malih riba</span>
                            </div>
                        </label>
                    </div>
                    
                    <div id="undersized-quantity-input" class="undersized-input-senior hidden">
                        <label for="undersized-quantity" class="label-senior">Koliko ima malih riba?</label>
                        <input type="number" id="undersized-quantity" step="0.1" min="0.1" 
                               class="input-senior" placeholder="0.5">
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Unesite koliƒçinu premale ribe (u kg ili kom)
                        </div>
                    </div>
                </div>
                
                <button id="continue-btn" class="btn-senior-primary">
                    ‚úÖ NASTAVI NA ODREDI≈†TE
                </button>
            </main>
        </div>

        <!-- Traceability Screen -->
        <div id="screen-traceability" class="screen">
            <header class="header-senior">
                <h1>üì¶ PODACI O RIBI</h1>
                <p class="header-subtitle-senior">Jo≈° nekoliko pitanja o ribi koju prodajete</p>
            </header>
            
            <main class="main-content-senior">
                <div class="progress-indicator-senior">
                    <div class="progress-step active">4</div>
                    <div class="progress-label">Podaci o prodaji</div>
                </div>
                
                <div class="form-container-senior">
                    <div class="form-group-senior">
                        <label for="product-form-select" class="label-senior">üêü Kakva je riba? *</label>
                        <select id="product-form-select" class="select-senior" required>
                            <option value="">Odaberite stanje ribe...</option>
                            <option value="SVJE≈Ω">Svje≈æa riba</option>
                            <option value="SMRZNUT">Smrznuta riba</option>
                            <option value="FILETI">Fileti (bez kostiju)</option>
                            <option value="CIJELI">Cijela riba</option>
                            <option value="POLU-PRERAƒêEN">Djelomiƒçno obraƒëena</option>
                            <option value="KONZERVIRAN">Konzervirana riba</option>
                        </select>
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            U kakvom stanju je riba koju prodajete
                        </div>
                    </div>
                    
                    <div class="form-group-senior">
                        <label for="purpose-phase-select" class="label-senior">üí∞ Kome prodajete? *</label>
                        <select id="purpose-phase-select" class="select-senior" required>
                            <option value="">Odaberite kupca...</option>
                            <option value="PRODAJA">Direktno kupcima</option>
                            <option value="TRGOVINA">Trgovini (veleprodaja)</option>
                            <option value="RESTORAN">Restoranu ili hotelu</option>
                            <option value="PRERADA">Za daljnju preradu</option>
                            <option value="KONZUM">Za sebe (osobno)</option>
                            <option value="IZVOZ">Izvoz u inozemstvo</option>
                        </select>
                        <div class="help-text-senior">
                            <span class="help-icon">‚ÑπÔ∏è</span>
                            Tko ƒáe kupiti va≈°u ribu
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="destination-select">Gdje ide riba? *</label>
                        <small>Odaberite gdje ƒáete prodati ili odnijeti ribu</small>
                        
                        <div class="destination-selection">
                            <div class="destination-buttons-large">
                                <button type="button" class="destination-btn-large selected" data-destination="NA PLOVILU">
                                    <div class="dest-icon">üö¢</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Na plovilu</div>
                                        <div class="dest-desc">Ostaje na brodu</div>
                                    </div>
                                </button>
                                
                                <button type="button" class="destination-btn-large" data-destination="TR≈ΩNICA">
                                    <div class="dest-icon">üè™</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Tr≈ænica</div>
                                        <div class="dest-desc">Split, Rijeka, Zagreb...</div>
                                    </div>
                                </button>
                                
                                <button type="button" class="destination-btn-large" data-destination="HLADNJAƒåA">
                                    <div class="dest-icon">‚ùÑÔ∏è</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Hladnjaƒça</div>
                                        <div class="dest-desc">Skladi≈°te, ƒçuvar</div>
                                    </div>
                                </button>
                                
                                <button type="button" class="destination-btn-large" data-destination="RESTORAN">
                                    <div class="dest-icon">üçΩÔ∏è</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Restoran</div>
                                        <div class="dest-desc">Hotel, konoba</div>
                                    </div>
                                </button>
                                
                                <button type="button" class="destination-btn-large" data-destination="PRIVATNO">
                                    <div class="dest-icon">üè†</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Privatno</div>
                                        <div class="dest-desc">Susjedima, prijateljima</div>
                                    </div>
                                </button>
                                
                                <button type="button" class="destination-btn-large" data-destination="DRUGO">
                                    <div class="dest-icon">üìù</div>
                                    <div class="dest-text">
                                        <div class="dest-title">Drugo</div>
                                        <div class="dest-desc">Napi≈°ite sami</div>
                                    </div>
                                </button>
                            </div>
                            
                            <!-- Hidden text input - only shows when "Drugo" is selected -->
                            <div id="custom-destination-input" class="custom-destination hidden">
                                <input type="text" id="destination-input" placeholder="Napi≈°ite gdje ide riba..." 
                                       maxlength="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="traceability-summary-senior">
                        <div id="traceability-preview" class="preview-senior">
                            <div class="preview-card-senior">
                                <h4>üìã PREGLED PODATAKA</h4>
                                <p class="preview-note-senior">Podaci ƒáe se prikazati kada odaberete sve opcije</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="button-container-senior">
                    <button id="back-to-quantity-btn" class="btn-senior-secondary">
                        ‚Üê NATRAG NA KOLIƒåINU
                    </button>
                    <button id="generate-lot-btn" class="btn-senior-primary" disabled>
                        üéØ ZAVR≈†I I NAPRAVI LOT
                    </button>
                </div>
            </main>
            </div>
        </div>

        <!-- Ekran 4: LOT rezultat -->
        <div id="screen-result" class="screen">
            <header class="header">
                <h2>LOT KREIRAN</h2>
            </header>
            
            <main class="main-content">
                <div class="lot-summary" id="lot-summary">
                    <!-- Dinamiƒçki generiran sa≈æetak -->
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="downloadPDF()">
                        PREUZMI PDF
                    </button>
                    <button class="export-btn" onclick="downloadCSV()">
                        PREUZMI CSV
                    </button>
                    <button class="export-btn" onclick="showQR()">
                        PRIKA≈ΩI QR KOD
                    </button>
                    <button class="export-btn" onclick="generateLabel()">
                        NALIJEPNICA ZA AMBALA≈ΩU
                    </button>
                </div>
                
                <div class="compliance-warning">
                    <p> OBAVEZNO: LOT broj mora biti fiziƒçki oznaƒçen na ambala≈æi proizvoda (Uredba EU 2023/2842, ƒçl. 58)</p>
                </div>
                
                <button class="primary-btn" onclick="newCatch()">
                    NOVI ULOV
                </button>
            </main>
        </div>

        <!-- QR Code Modal -->
        <div id="qr-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div id="qr-code"></div>
                <p>LOT ID: <span id="qr-lot-id"></span></p>
            </div>
        </div>
    </div>

    <!-- Development cache management - preserves Croatian vessel configuration -->
    <script>
        console.log('üîß Development mode - selective cache management');
        
        // Only clear application caches, preserve vessel configuration
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => {
                    if (name.includes('fisherman') || name.includes('lot')) {
                        console.log('üóëÔ∏è Clearing app cache:', name);
                        caches.delete(name);
                    }
                });
            });
        }
        
        // Preserve vessel configuration in localStorage
        const preservedVesselConfig = localStorage.getItem('fishermen_vessel_config');
        
        console.log('‚úÖ Vessel configuration preserved for Croatian fishermen');
    </script>
    
    <!-- Scripts with NEW timestamp - CATEGORIZED SPECIES INTERFACE -->
    <script src="js/db.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/gps.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/vessel-config.js?v=4.0&t=20260107180000&bust=${Math.random()}"></script>
    <script src="js/lot-manager.js?v=4.0&t=20260107180000&bust=${Math.random()}"></script>
    <script src="js/lot-generator.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/export.js?v=3.0&t=20260106215000&bust=${Math.random()}"></script>
    <script src="js/professional-app.js?v=4.0&t=20260107190000&bust=${Math.random()}"></script>
    
    <!-- SERVICE WORKER DISABLED - NO CACHING DURING DEVELOPMENT -->
    <script>
        console.log('üö´ Service Worker disabled to prevent caching issues');
        
        // Unregister any existing service workers
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => {
                    console.log('üóëÔ∏è Unregistering Service Worker:', registration);
                    registration.unregister();
                });
            });
        }
        
        console.log('‚úÖ No caching - files will load fresh every time');
    </script>
</body>
</html>
